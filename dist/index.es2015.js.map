{"version":3,"file":"index.es2015.js","sources":["../src/index.js"],"sourcesContent":["// Defaults\nconst defaultOptions = {\n  format: \"image/png\",\n  quality: 0.92,\n  width: undefined,\n  height: undefined,\n  Canvas: undefined\n};\n\n// Return Promise\nconst mergeImages = (sources = [], options = {}) =>\n  new Promise(resolve => {\n    options = Object.assign({}, defaultOptions, options);\n\n    // Setup browser/Node.js specific variables\n    const canvas = options.Canvas\n      ? new options.Canvas.createCanvas()\n      : window.document.createElement(\"canvas\");\n    const Image = options.Canvas ? options.Canvas.Image : window.Image;\n    if (options.Canvas) {\n      options.quality *= 100;\n    }\n\n    // Load sources\n    const images = sources.map(\n      source =>\n        new Promise((resolve, reject) => {\n          // Convert sources to objects\n          if (source.constructor.name !== \"Object\") {\n            source = { src: source };\n          }\n\n          // Resolve source and img when loaded\n          const img = new Image();\n          img.onerror = () => reject(new Error(\"Couldn't load image\"));\n          img.onload = () => resolve(Object.assign({}, source, { img }));\n          img.src = source.src;\n        })\n    );\n\n    // Get canvas context\n    const ctx = canvas.getContext(\"2d\");\n\n    // When sources have loaded\n    resolve(\n      Promise.all(images).then(images => {\n        // Set canvas dimensions\n        const getSize = dim =>\n          options[dim] || Math.max(...images.map(image => image.img[dim]));\n        canvas.width = getSize(\"width\");\n        canvas.height = getSize(\"height\");\n\n        // Draw images to canvas\n        images.forEach(image => {\n          ctx.globalAlpha = image.opacity ? image.opacity : 1;\n          return ctx.drawImage(image.img, image.x || 0, image.y || 0);\n        });\n\n        if (options.Canvas && options.format === \"image/jpeg\") {\n          // Resolve data URI for node-canvas jpeg async\n          return new Promise(resolve => {\n            canvas.toDataURL(\n              options.format,\n              {\n                quality: options.quality,\n                progressive: false\n              },\n              (err, jpeg) => {\n                if (err) {\n                  throw err;\n                }\n                resolve(jpeg);\n              }\n            );\n          });\n        }\n\n        // Resolve all other data URIs sync\n        return canvas.toDataURL(options.format, options.quality);\n      })\n    );\n  });\n\nmodule.exports = mergeImages;\n"],"names":["const"],"mappings":"AAAA;AACAA,IAAM,cAAc,GAAG;EACrB,MAAM,EAAE,WAAW;EACnB,OAAO,EAAE,IAAI;EACb,KAAK,EAAE,SAAS;EAChB,MAAM,EAAE,SAAS;EACjB,MAAM,EAAE,SAAS;CAClB,CAAC;;;AAGFA,IAAM,WAAW,aAAI,OAAY,EAAE,OAAY,EAAE;qCAArB,GAAG;qCAAW,GAAG;;WAC3C,IAAI,OAAO,WAAC,SAAQ;IAClB,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,cAAc,EAAE,OAAO,CAAC,CAAC;;;IAGrDA,IAAM,MAAM,GAAG,OAAO,CAAC,MAAM;QACzB,IAAI,OAAO,CAAC,MAAM,CAAC,YAAY,EAAE;QACjC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAC5CA,IAAM,KAAK,GAAG,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;IACnE,IAAI,OAAO,CAAC,MAAM,EAAE;MAClB,OAAO,CAAC,OAAO,IAAI,GAAG,CAAC;KACxB;;;IAGDA,IAAM,MAAM,GAAG,OAAO,CAAC,GAAG;gBACxB,QAAO,SACL,IAAI,OAAO,WAAE,OAAO,EAAE,MAAM,EAAE;;UAE5B,IAAI,MAAM,CAAC,WAAW,CAAC,IAAI,KAAK,QAAQ,EAAE;YACxC,MAAM,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,CAAC;WAC1B;;;UAGDA,IAAM,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;UACxB,GAAG,CAAC,OAAO,eAAM,SAAG,MAAM,CAAC,IAAI,KAAK,CAAC,qBAAqB,CAAC,IAAC,CAAC;UAC7D,GAAG,CAAC,MAAM,eAAM,SAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,EAAE,OAAE,GAAG,EAAE,CAAC,IAAC,CAAC;UAC/D,GAAG,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;SACtB,IAAC;KACL,CAAC;;;IAGFA,IAAM,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;;IAGpC,OAAO;MACL,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,WAAC,QAAO;;QAE9BA,IAAM,OAAO,aAAG,KAAI,SAClB,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,SAAG,CAAC,MAAG,MAAM,CAAC,GAAG,WAAC,OAAM,SAAG,KAAK,CAAC,GAAG,CAAC,GAAG,IAAC,CAAC,IAAC,CAAC;QACnE,MAAM,CAAC,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;QAChC,MAAM,CAAC,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;;QAGlC,MAAM,CAAC,OAAO,WAAC,OAAM;UACnB,GAAG,CAAC,WAAW,GAAG,KAAK,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,GAAG,CAAC,CAAC;UACpD,OAAO,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;SAC7D,CAAC,CAAC;;QAEH,IAAI,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,YAAY,EAAE;;UAErD,OAAO,IAAI,OAAO,WAAC,SAAQ;YACzB,MAAM,CAAC,SAAS;cACd,OAAO,CAAC,MAAM;cACd;gBACE,OAAO,EAAE,OAAO,CAAC,OAAO;gBACxB,WAAW,EAAE,KAAK;eACnB;wBACA,GAAG,EAAE,IAAI,EAAE;gBACV,IAAI,GAAG,EAAE;kBACP,MAAM,GAAG,CAAC;iBACX;gBACD,OAAO,CAAC,IAAI,CAAC,CAAC;eACf;aACF,CAAC;WACH,CAAC,CAAC;SACJ;;;QAGD,OAAO,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;OAC1D,CAAC;KACH,CAAC;GACH;CAAC,CAAC;;AAEL,MAAM,CAAC,OAAO,GAAG,WAAW,CAAC"}